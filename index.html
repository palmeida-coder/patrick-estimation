<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estimation Gratuite - Patrick Almeida Lyon</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
</head>
<body class="bg-gray-50">
    <!-- HEADER PATRICK ALMEIDA -->
    <header class="bg-green-600 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <div class="w-24 h-24 bg-white rounded-full mx-auto mb-4 flex items-center justify-center">
                <span class="text-green-600 font-bold text-2xl">PA</span>
            </div>
            <h1 class="text-3xl font-bold">Patrick Almeida</h1>
            <p class="text-xl">Agent Immobilier Expert ‚Ä¢ Efficity Lyon</p>
            <p class="text-lg">Sp√©cialiste vente particuliers ‚Ä¢ 15 ans d'exp√©rience</p>
            <div class="flex justify-center items-center mt-4">
                <span class="text-yellow-400">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span class="ml-2">500+ ventes r√©alis√©es √† Lyon</span>
            </div>
        </div>
    </header>

    <!-- SECTION ESTIMATION -->
    <section class="py-12">
        <div class="container mx-auto px-4">
            <div class="grid md:grid-cols-2 gap-8">
                <!-- COLONNE GAUCHE - AVANTAGES -->
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h2 class="text-2xl font-bold text-green-600 mb-6 flex items-center">
                        üè† Estimation gratuite de votre bien
                    </h2>
                    <p class="text-gray-700 mb-6">
                        Obtenez une <strong>estimation pr√©cise et gratuite</strong> de votre propri√©t√©
                        Lyon par un expert du march√© local.
                    </p>
                    
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <span class="text-green-500 mr-3">‚úì</span>
                            <span>Analyse du march√© en temps r√©el</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-green-500 mr-3">‚úì</span>
                            <span>Visite gratuite sous 48H</span>
                        </div>
                        <div class="flex items-center">
                            <span class="text-green-500 mr-3">‚úì</span>
                            <span>Strat√©gie de vente personnalis√©e</span>
                        </div>
                    </div>

                    <!-- R√âF√âRENCES LYON -->
                    <div class="bg-green-50 p-4 rounded-lg mt-6">
                        <h3 class="font-bold text-green-700 mb-2">üìä Mes r√©f√©rences Lyon</h3>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <div class="text-2xl font-bold text-green-600">500+</div>
                                <div class="text-sm">Ventes r√©alis√©es</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-green-600">47j</div>
                                <div class="text-sm">D√©lai moyen</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-green-600">+12%</div>
                                <div class="text-sm">Prix optimis√©</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- COLONNE DROITE - FORMULAIRE -->
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <h3 class="text-xl font-bold mb-6 flex items-center">
                        üìù Demande d'estimation
                    </h3>
                    <p class="text-gray-600 mb-6">
                        Remplissez ce formulaire pour recevoir votre estimation gratuite
                    </p>

                    <form id="estimationForm" class="space-y-4">
                        <!-- COORDONN√âES -->
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Pr√©nom *</label>
                                <input type="text" name="prenom" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nom *</label>
                                <input type="text" name="nom" required
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">T√©l√©phone *</label>
                                <input type="tel" name="telephone" required
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">E-mail *</label>
                                <input type="email" name="email" required
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>

                        <!-- BIEN IMMOBILIER -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Adresse du bien √† vendre *</label>
                            <input type="text" name="adresse" required placeholder="Ex: 4 Rue Laurent Mourguet, Lyon 5√®me"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Type de bien *</label>
                                <select name="type_bien" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                    <option value="">S√©lectionnez</option>
                                    <option value="appartement">Appartement</option>
                                    <option value="maison">Maison</option>
                                    <option value="studio">Studio</option>
                                    <option value="loft">Loft</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Surface (m¬≤) *</label>
                                <input type="number" name="surface" required min="10" max="500"
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre de pi√®ces</label>
                                <select name="pieces"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                    <option value="">S√©lectionnez</option>
                                    <option value="1">1 pi√®ce</option>
                                    <option value="2">2 pi√®ces</option>
                                    <option value="3">3 pi√®ces</option>
                                    <option value="4">4 pi√®ces</option>
                                    <option value="5+">5+ pi√®ces</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">√âtage</label>
                                <input type="text" name="etage" placeholder="Ex: 2√®me √©tage"
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>

                        <!-- PROJET VENTE -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Prix de vente souhait√© (optionnel)</label>
                            <input type="number" name="prix_souhaite" placeholder="Ex: 320000"
                                   class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">D√©lai de vente souhait√©</label>
                            <select name="delai_vente"
                                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">S√©lectionnez</option>
                                <option value="1-3 mois">1 √† 3 mois</option>
                                <option value="3-6 mois">3 √† 6 mois</option>
                                <option value="6+ mois">Plus de 6 mois</option>
                            </select>
                        </div>

                        <!-- INFORMATIONS COMPL√âMENTAIRES -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Informations compl√©mentaires</label>
                            <textarea name="informations" rows="3" 
                                     placeholder="Travaux r√©cents, particularit√©s du bien, situation personnelle..."
                                     class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500"></textarea>
                        </div>

                        <!-- BOUTON SOUMISSION -->
                        <button type="submit" id="submitBtn"
                                class="w-full bg-green-600 text-white py-4 px-6 rounded-lg font-bold text-lg hover:bg-green-700 transition-colors">
                            üè† Demander mon estimation gratuite
                        </button>

                        <p class="text-xs text-gray-500 text-center">
                            * Champs obligatoires ‚Ä¢ Donn√©es s√©curis√©es ‚Ä¢ R√©ponse sous 24h
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- CONTACT DIRECT -->
    <section class="bg-white py-8">
        <div class="container mx-auto px-4 text-center">
            <h3 class="text-xl font-bold mb-4">üìû Contact direct</h3>
            <div class="flex justify-center space-x-8">
                <div>
                    <span class="text-green-600 font-bold">üì± 06.XX.XX.XX.XX</span>
                    <p class="text-sm text-gray-600">(Direct 7j/7)</p>
                </div>
                <div>
                    <span class="text-green-600 font-bold">‚úâÔ∏è palmeida@efficity.com</span>
                    <p class="text-sm text-gray-600">(R√©ponse rapide)</p>
                </div>
                <div>
                    <span class="text-green-600 font-bold">üìç Efficity Lyon 4√®me</span>
                    <p class="text-sm text-gray-600">(Centre-ville)</p>
                </div>
            </div>
        </div>
    </section>

    <!-- LOADING OVERLAY -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"></div>
            <p class="text-lg font-medium">Envoi de votre demande...</p>
            <p class="text-sm text-gray-600">Patrick vous recontactera dans les 24h</p>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        document.getElementById('estimationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Afficher loading
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            // Collecter donn√©es formulaire
            const formData = new FormData(this);
            const data = {
                prenom: formData.get('prenom'),
                nom: formData.get('nom'),
                telephone: formData.get('telephone'),
                email: formData.get('email'),
                adresse: formData.get('adresse'),
                type_bien: formData.get('type_bien'),
                surface: parseInt(formData.get('surface')),
                pieces: formData.get('pieces'),
                etage: formData.get('etage'),
                prix_souhaite: formData.get('prix_souhaite') ? parseInt(formData.get('prix_souhaite')) : null,
                delai_vente: formData.get('delai_vente'),
                informations: formData.get('informations'),
                
                // Tracking data
                source: 'estimation_email_externe',
                url_referrer: document.referrer,
                user_agent: navigator.userAgent,
                timestamp: new Date().toISOString(),
                utm_source: new URLSearchParams(window.location.search).get('utm_source') || 'bitly',
                utm_campaign: new URLSearchParams(window.location.search).get('utm_campaign') || 'patrick_estimation_lyon'
            };

            try {
                // WEBHOOK PRINCIPAL vers CRM Patrick (URL CORRIG√âE)
                const response = await fetch('https://leadgen-auto-1.preview.emergentagent.com/api/estimation/submit-prospect-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    // Tracking Google Analytics
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'form_submit', {
                            event_category: 'lead_generation',
                            event_label: 'estimation_externe',
                            value: 1
                        });
                    }
                    
                    // Succ√®s - Rediriger vers page de confirmation
                    showSuccessMessage();
                } else {
                    throw new Error('Erreur serveur');
                }

            } catch (error) {
                console.error('Erreur webhook:', error);
                
                // FALLBACK 1 - Zapier Webhook (√Ä CONFIGURER)
                try {
                    await fetch('https://hooks.zapier.com/hooks/catch/VOTRE_WEBHOOK_ID_ICI/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    showSuccessMessage();
                } catch (zapierError) {
                    // FALLBACK 2 - Email direct √† Patrick
                    const emailBody = `
Nouvelle demande d'estimation immobili√®re

CONTACT:
- Nom: ${data.prenom} ${data.nom}
- T√©l√©phone: ${data.telephone}
- Email: ${data.email}

BIEN:
- Adresse: ${data.adresse}
- Type: ${data.type_bien}
- Surface: ${data.surface}m¬≤
- Pi√®ces: ${data.pieces}
- √âtage: ${data.etage}
- Prix souhait√©: ${data.prix_souhaite || 'Non pr√©cis√©'}‚Ç¨
- D√©lai: ${data.delai_vente}

INFORMATIONS: ${data.informations}

Source: Formulaire estimation externe Netlify
Date: ${new Date().toLocaleString('fr-FR')}
                    `;
                    
                    const mailtoLink = `mailto:palmeida@efficity.com?subject=URGENT - Estimation ${data.prenom} ${data.nom}&body=${encodeURIComponent(emailBody)}`;
                    window.location.href = mailtoLink;
                    
                    showSuccessMessage();
                }
            }
            
            // Masquer loading
            document.getElementById('loadingOverlay').classList.add('hidden');
        });

        function showSuccessMessage() {
            document.body.innerHTML = `
                <div class="min-h-screen bg-green-50 flex items-center justify-center">
                    <div class="bg-white p-12 rounded-lg shadow-lg text-center max-w-md">
                        <div class="text-6xl mb-6">‚úÖ</div>
                        <h2 class="text-2xl font-bold text-green-600 mb-4">Demande envoy√©e !</h2>
                        <p class="text-gray-700 mb-6">
                            Merci pour votre demande d'estimation.<br>
                            <strong>Patrick Almeida</strong> vous recontactera dans les <strong>24 heures</strong>.
                        </p>
                        <div class="bg-green-100 p-4 rounded-lg">
                            <p class="text-sm text-green-800">
                                üì± Contact direct: 06.XX.XX.XX.XX<br>
                                ‚úâÔ∏è palmeida@efficity.com
                            </p>
                        </div>
                        <div class="mt-4">
                            <p class="text-xs text-gray-500">
                                Syst√®me Patrick IA ‚Ä¢ Leadgen-Auto-1<br>
                                Efficity Lyon ‚Ä¢ Solution externe s√©curis√©e
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Analytics page view tracking
        if (typeof gtag !== 'undefined') {
            gtag('event', 'page_view', {
                page_title: 'Estimation Patrick Almeida Lyon',
                page_location: window.location.href,
                page_source: 'netlify_externe'
            });
        }
    </script>
</body>
</html>